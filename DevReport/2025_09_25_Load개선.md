#### 1. 원인 분석
Load가 느린데 원인은 무엇일까..?
##### OLEDB 연결, 프로시저 호출 분석
기존 로직에서 지연 발생시 로그남기는 부분이 좀 과하게 남기는 경향이 있어 수정 하였습니다. 지연발생->로그파일 읽기&즉시생성->성능저하->다음 프로시저 호출에서 추가지연 발생 -> ...\
과정으로 로그파일 생성이 성능에 영향을 끼친다는 분석(클로드 코드)을 기반으로 수정을 하였습니다.

<img width="1036" height="1028" alt="image" src="https://github.com/user-attachments/assets/de304f7b-2f28-41b1-b7af-815e6ed87895" />
기존 호출 방식, 신규 호출 방식으로 Load,Save 프로시저들을 불특정하게 Loop로 호출을 해보았습니다. 결과는연결방식에 따라 DB가 느려지거나 빨라지는 것은 확인 안되고, 속도도 매우 준수 30ms로 안정적인 것으로 확인되었습니다.

그렇게 더미를 넣어 실비교를 해보자는 생각으로 영상을 몇개 촬영해 보았고, 이상한 부분을 찾아볼 수 있었습니다.

<img width="1174" height="585" alt="image" src="https://github.com/user-attachments/assets/7a5a219b-933c-4a83-a32e-08f8b958f1e2" />
<img width="508" height="807" alt="image" src="https://github.com/user-attachments/assets/b8130404-7f83-40d6-a4e2-86abac129d6f" />


LoginLogoutLoop ->GameDB-> LoadCompleate 과정을 측정해봤을때, 80~100ms 속도가 200ms이상으로 중간중간 눈에 띄게 느려지는 구간이 있었고,
더 이전 녹화 영상에서 버퍼가 쌓여 끊어지는 과정에서 SaveDB가 돌았을 때 더 심하게 지연(700ms)이 발생했음을 알게되었습니다.
결론은 지속적인 SaveDB의 느린 속도가 Load를 지연시키고, Load는 다건의 패킷을 보내 SaveLoop를 느리게 만들어 순간적으로 더 많은 다건의 SaveDB를 패킷을 보내게 만들지 않았나 추측을 해본다.

<img width="772" height="497" alt="image" src="https://github.com/user-attachments/assets/4da4a5a4-2a1d-4fb7-bce2-0ab8d504375c" />


1000명 더미를 넣었을 때 3분~5분 저장을 시키면 SaveDB는 초당 5번 호출되는 것으로 확인된다(GameDB기준). 그럴 경우 처리해야할 순수 저장 패킷의 수는 1명당 20+개를 순간적으로 처리하는데, 20+개를 다 처리하는데, 0.08~0.1초 정도의 시간이 사용된다.\
(savechar totalm은 메인저장 패킷 단 1개만 처리 했을 때의 시간을 측정한다.)

싱글 스레드에서의 다수의 순간 발생 패킷은 성능을 저하 시킨다는 결과를 도출하였다(GPT,Gemini). 기존 SaveDB의 패킷 구조 개선, LoadPC의 패킷 개선이 필요해 보인다.


#### 2. 구조 개선
사실 구조 개선은 간단하다. 패킷을 하나로 묶으면 되는 것이다.

<img width="1022" height="403" alt="image" src="https://github.com/user-attachments/assets/e64956cc-bc0e-4852-a6ee-619a9b8f3644" />


기존 패킷을 하나로 묶었고, SaveDB에서 패킷을 단 21->3개만 보내게 수정을 하였다. 결과는 성능이 대략 20~30% 정도만 개선된 것으로 보인다.
